#include "dino_Castle.h"
#include "dino_ShareData.h"
#include "oled.h"
#include "dino_level.h"

//城堡
const unsigned char  Castle[] ={	
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xBF,0xB7,0xB7,0xB0,0x80,0xB0,0xB0,0xB0,0x30,0xBF,0xB7,0xB7,0x87,0xB7,0xB7,0xB0,0x30,0xB0,0xB0,
	0xB0,0x80,0xB0,0xB7,0xB7,0x37,0xB7,0xB7,0xBF,0x80,0xB0,0xB0,0xB0,0x30,0xB0,0xB0,0xB7,0x87,0xBF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x6D,0x6D,0x6D,0x6D,0x61,0x6D,0x6D,0x00,0x00,0x00,0x00,0x00,0xED,0xED,0xED,0xED,0x0C,0xED,0xED,
	0xED,0xE1,0xED,0xED,0xED,0x0C,0x7D,0x00,0x00,0x00,0x00,0x00,0xED,0x0C,0x6D,0x6D,0xED,0xE1,0xED,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xB6,0xB6,0xBE,0x80,0xB0,0xB0,0xB0,0x30,0xB0,0xBE,0xB6,0x86,0xB6,0xB6,0xB6,0x3E,0xB0,0xB0,0xB3,0x93,0xB0,0xBE,0xB6,0x36,0xB6,0xB6,0xB6,0x8E,0xB0,0x30,0x32,0x32,
	0x32,0x32,0x31,0x90,0xBE,0xB6,0xB6,0x36,0xBE,0xB0,0xB1,0x93,0xB3,0xB3,0xB1,0x30,0xBE,0xB6,0xB6,0x86,0xB6,0xBE,0xB0,0x30,0xB0,0xB0,0xB0,0x80,0xBE,0xB6,0xB6,0x36,
	0x6D,0x6D,0x6D,0x61,0x6D,0x6D,0x6D,0x0C,0x6D,0x6D,0x6D,0x61,0x6D,0x6D,0x6D,0x0C,0x6D,0x6D,0x6D,0x61,0x6D,0x6D,0x6D,0x6C,0x05,0x01,0x01,0x01,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x04,0x6D,0x6D,0x6D,0x61,0x6D,0x6D,0x6D,0x0C,0x6D,0x6D,0x6D,0x61,0x6D,0x6D,0x6D,0x0C,0x6D,0x6D,0x6D,0x61,0x6D,0x6D,0x6D,0x0C,
	0xDB,0xDB,0xDB,0x18,0xDB,0xDB,0xDB,0xC3,0xDB,0xDB,0xDB,0x18,0xDB,0xDB,0xDB,0xC3,0xDB,0xDB,0xDB,0x18,0xDB,0xDB,0xDB,0xDB,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xDB,0xDB,0xDB,0x18,0xDB,0xDB,0xDB,0xC3,0xDB,0xDB,0xDB,0x18,0xDB,0xDB,0xDB,0xC3,0xDB,0xDB,0xDB,0x18,0xDB,0xDB,0xDB,0xC3,
};


//加载城堡
char load_castle()
{
	if (castle_pos[0] <= screen_right && castle_pos[0] + 63 >= screen_left) return 1;
	else if (castle_pos[0] <= screen_right + 10 && castle_pos[0] + 63 >= screen_left - 10) return 2;
	else return 0;
}

//显示城堡
void OLED_Drawcastle(char castle_sign)
{
	unsigned int j = 0;
	unsigned char x, y;
	char setx,draw_start_x;

	static int last_screen_x;
	static int last_screen_y;
	static signed char last_deep;
	static int* p1 = &last_screen_x;
	static int* p2 = &last_screen_y;
	static signed char* p3 = &last_deep;
	if (castle_sign  == 1)
	{

		if (castle_pos[0] - screen_left < 0)
		{
			setx = 0;
			draw_start_x = -(castle_pos[0] - screen_left);
		}
		else
		{
			setx = castle_pos[0] - screen_left;
			draw_start_x = 0;
		}

		for (y = 0; y < 6; y++)
		{
			OLED_SetPos(setx, y+2);
			for (x = draw_start_x; x < 64; x++)
			{
				if (castle_pos[0] - screen_left + x > 127) break;
				//恐龙遮蔽效果
				if (cover == 1)
				{
					if (castle_pos[0] - screen_left + x >= dino_x && castle_pos[0] - screen_left + x <= dino_x + 15 && y+2 >= dino_deep && y+2 <= dino_deep+1)
					{
						OLED_SetPos(castle_pos[0] - screen_left + x + 1, y+2);
						continue;
					} 
				}
				j = y*64 + x;
				oledWriteByte(Castle[j],OLED_DATA);
			}
		}
		OLED_shadowclear(castle_pos[0] - screen_left,0,2,64,40,p1,p2,p3,normalcy);
		if (dino_y == 0)
		{
			if (direction == '->')
			{
				if (dino_x + 15 >= castle_pos[0] -screen_left + 39 && dino_x <= castle_pos[0] -screen_left + 39)
				{
					dino_x = castle_pos[0] - screen_left + 24;
				}
				
			}
			else if (direction == '<-')
			{
				if (dino_x  <= castle_pos[0] -screen_left + 24 &&  dino_x + 15 >= castle_pos[0] -screen_left + 24)
				{
					dino_x = castle_pos[0] - screen_left + 24;
				}
				
			}
		}
		
		if (dino_x  >= castle_pos[0] -screen_left +24 && dino_x + 15 <= castle_pos[0] -screen_left + 39 && dino_y == 0)
		{
			finish = 1;
			UART1_send(mla_finish,6);
		}
		
	}
	else if (castle_sign  == 2)
	{
		OLED_shadowclear(castle_pos[0] - screen_left,0,2,64,40,p1,p2,p3,normalcy);
	}

	
		
}
